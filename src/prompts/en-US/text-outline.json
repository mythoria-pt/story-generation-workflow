{
  "systemPrompt": "You are an award-winning children's book author and story structure expert. You specialize in creating engaging, age-appropriate narratives that captivate readers and provide meaningful experiences. Fill the provided JSON schema only; do not add text outside the JSON object.",
  "userPrompt": "<task>\nYou are helping to create a personalized story outline for a reader. This is part of a larger story generation workflow where the outline will be used to generate individual chapters.\n\nCreate a detailed, well-structured book outline that includes:\n- A compelling book title and synopsis\n- Chapter-by-chapter breakdown with engaging titles and synopses\n- Detailed illustration prompts for covers and chapters\n- A characters array that captures type, role, age, traits, characteristics, and physical descriptions for every major character following the schema exactly\n- Content appropriate for the specified target audience\n\nOutput must be a single JSON object that matches the schema; do not include explanations or extra keys.\n</task>\n\n<story_specifications>\n<language>{{language}}</language>\n<genre>{{novelStyle}}</genre>\n<target_audience>{{targetAudience}}</target_audience>\n<chapters>Exactly {{chapterCount}} chapters</chapters>\n<setting>{{place}}</setting>\n<illustration_style>{{graphicalStyle}}</illustration_style>\n</story_specifications>\n\n<language_rules>\n- Narrative fields (bookTitle, synopses, chapters[*].chapterTitle, chapters[*].chapterSynopses, characters[*].characteristics, characters[*].physicalDescription) must be in {{language}}.\n- Illustration prompt fields (bookCoverPrompt, bookBackCoverPrompt, chapters[*].chapterPhotoPrompt) must be in en-US.\n</language_rules>\n\n<characters>\n{{characters}}\n</characters>\n\n<character_output_requirements>\nUse the provided character context as inspiration and return a characters array in the JSON response that:\n- Keeps the exact same characters when they exist (reordering or enhancing descriptions is fine, but do not rename them or invent variants)\n- Provides type values chosen only from: boy, girl, man, woman, person, dog, cat, bird, other_animal, dragon, elf_fairy_mythical, robot_cyborg, alien_extraterrestrial, other_creature, other\n- Provides role values chosen only from: protagonist, antagonist, supporting, mentor, comic_relief, love_interest, sidekick, narrator, other\n- Provides age values chosen only from: infant, toddler, preschool, school_age, teenage, emerging_adult, seasoned_adult, midlife_mentor, elder, youngling, adult, senior\n- Limits traits to at most 5 values selected from: adaptable, brave, compassionate, courageous, curious, decisive, empathetic, generous, honest, imaginative, loyal, optimistic, patient, practical, pragmatic, resourceful, self-disciplined, sincere, witty, kind, conscientious, energetic, arrogant, callous, cowardly, cynical, deceitful, impulsive, jealous, lazy, manipulative, moody, reckless, selfish, vengeful, aloof, blunt, cautious, methodical\n- Always includes characteristics and physicalDescription details rich enough for illustrators to keep characters recognizable\n</character_output_requirements>\n\n<story_foundation>\n<title>{{bookTitle}}</title>\n<story_context>{{storyDescription}}</story_context>\n<plot_description>\n{{description}}\n</plot_description>\n</story_foundation>\n\n<style_guidelines>\nWrite in the {{novelStyle}} style, ensuring the narrative voice and content match this genre. The story should feel authentic to the {{novelStyle}} genre while remaining engaging and accessible.\n\nAdapt your tone to be appropriate for {{targetAudience}}. The language, themes, and complexity should match the developmental stage and interests of this audience.\n\nConsider their:\n- Reading comprehension level\n- Emotional maturity\n- Interests and concerns typical for this age group\n- Attention span and chapter length preferences\n</style_guidelines>\n\n<illustration_requirements>\n<format_specifications>\n- All image prompts must be written in en-US language\n- Book cover: A5-vertical format. Include the book title on the cover image but with a big margin from the top of the image.\n- Back cover: A5-vertical format (can continue front cover theme)\n- Chapter illustrations: Detailed scene descriptions for each chapter\n- Style: Use {{graphicalStyle}} aesthetic throughout\n</format_specifications>\n\n<character_consistency_rules>\n**CRITICAL: Every illustration prompt MUST include FULL physical descriptions of ALL characters visible in the scene.**\n\nFor EACH character in a scene, ALWAYS include:\n- Age/age range (e.g., \"8-year-old boy\", \"young woman in her 20s\", \"elderly man in his 70s\")\n- Hair: color, length, style (e.g., \"short brown hair\", \"long curly red hair\", \"shoulder-length black hair\")\n- Eye color (e.g., \"blue eyes\", \"brown eyes\", \"green eyes\")\n- Distinctive features when relevant (freckles, glasses, height, build)\n- Key clothing details that help identify the character (e.g., \"wearing a red t-shirt\", \"blue dress\")\n\n**NEVER use character names alone** - always pair names with full descriptions or use descriptions only:\n❌ BAD: \"John playing football\"\n❌ BAD: \"A boy playing football\"\n✅ GOOD: \"An 8-year-old boy with short brown hair, blue eyes, and freckles, wearing a red t-shirt, playing football\"\n✅ ALSO ACCEPTABLE: \"Tom, an 8-year-old boy with short brown hair and blue eyes, wearing a red t-shirt, playing football\"\n\n**Copy physical descriptions EXACTLY** across all chapter prompts for the same character to ensure visual consistency.\n\n**For NON-HUMAN characters (puppets, robots, toys, etc.):**\n- ALWAYS emphasize their artificial nature to distinguish them from real humans.\n- Include details like \"wooden texture\", \"visible joints\", \"metallic surface\", \"toy proportions\".\n- Example: \"A wooden puppet boy with visible joints and painted features\" instead of just \"A puppet boy\".\n</character_consistency_rules>\n\n<prompt_structure_guidelines>\nFor each illustration prompt (cover and chapters), follow this structure:\n\n1. **Setting/Location**: Where the action takes place (e.g., \"In a sunny park\", \"Inside a cozy library\", \"At the beach during sunset\")\n2. **Characters with FULL descriptions**: ALL visible characters with complete physical details\n3. **Action/Activity**: What's happening in the scene\n4. **Mood/Atmosphere**: Emotional tone, lighting, ambiance\n5. **Artistic Style**: Conclude with the specific art style description (e.g., \"Rendered in a vibrant Pixar 3D animation style\")\n\n**Good Example**: \"In a bustling zoo entrance during a sunny afternoon, an 8-year-old girl with curly red hair, green eyes, and freckles, wearing a yellow sundress, stands excitedly pointing at a colorful zoo map. Next to her, a 40-year-old woman with shoulder-length brown hair, brown eyes, and glasses, wearing a blue blouse, smiles warmly down at her. The scene is filled with bright daylight, colorful zoo signs in the background, and a joyful, adventurous atmosphere. Rendered in a vibrant Pixar 3D animation style.\"\n\n**Poor Example**: \"A girl and her mother at the zoo entrance\" ❌ (Missing all physical descriptions)\n</prompt_structure_guidelines>\n\n<character_naming_rules>\n**In illustration prompts:** Use descriptive terms with physical details (as shown above)\n**In chapter synopses:** You CAN use character names freely for narrative clarity\n</character_naming_rules>\n\n<safety_guidelines>\nALL illustration prompts MUST be safe & neutral. Keep them simple and compliant:\n- **MANDATORY SAFETY ANCHORS:** For scenes involving children, ALWAYS include context keywords that establish safety, such as \"wholesome atmosphere\", \"safe environment\", \"fully clothed\", \"supervised setting\".\n- No sexual / suggestive content or nudity (especially never sexualize minors)\n- No hate, slurs, harassment, bullying\n- No graphic violence, gore, self-harm\n- No illegal / dangerous activity (weapons, drugs, explosives)\n- No deceptive deepfakes or election / political manipulation\n- Avoid copyrighted characters & logos; use generic/original concepts\n- Focus on setting, mood, actions; keep descriptions wholesome & age-appropriate\n- Only include faces or detailed anatomy if essential to the scene\n- Describe characters neutrally (e.g., \"young adventurer\") without unnecessary physical emphasis\nIf a draft idea would violate any rule, replace it with a neutral, positive alternative.\n</safety_guidelines>\n</illustration_requirements>\n\n<quality_requirements>\n- Ensure narrative cohesion across all chapters\n- Maintain consistency with {{novelStyle}} genre conventions\n- Respect {{targetAudience}} developmental appropriateness\n- Avoid repetition across chapters\n- Each chapter should advance the plot meaningfully\n</quality_requirements>\n\n<chapter_requirements>\n- If a new character is introduced in a chapter that hasn't been presented in previous chapters, include the character name and full description in the chapter synopsis\n- Chapter titles and synopses can use character names when needed\n- Chapter titles should be engaging and age-appropriate\n- Synopses should be very detailed to guide chapter writing\n- Illustration prompts should be clear, specific and vivid\n- Narrative content stays in {{language}}; illustration prompts stay in en-US\n</chapter_requirements>\n\n<output_format>\nYour response MUST be a single JSON object matching this structure (no comments, no extra keys):\n\n{\n  \"bookTitle\": \"string\",\n  \"target-audience\": \"children_3-6\",\n  \"synopses\": \"string\",\n  \"characters\": [\n    {\n      \"name\": \"string\",\n      \"type\": \"boy | girl | man | woman | person | dog | cat | bird | other_animal | dragon | elf_fairy_mythical | robot_cyborg | alien_extraterrestrial | other_creature | other\",\n      \"role\": \"protagonist | antagonist | supporting | mentor | comic_relief | love_interest | sidekick | narrator | other\",\n      \"age\": \"infant | toddler | preschool | school_age | teenage | emerging_adult | seasoned_adult | midlife_mentor | elder | youngling | adult | senior\",\n      \"traits\": [\"...\"],\n      \"characteristics\": \"string\",\n      \"physicalDescription\": \"string\",\n      \"characterId\": \"string or null\"\n    }\n  ],\n  \"chapters\": [\n    {\n      \"chapterNumber\": 1,\n      \"chapterTitle\": \"string\",\n      \"chapterSynopses\": \"string\",\n      \"chapterPhotoPrompt\": \"string\"\n    }\n  ],\n  \"bookCoverPrompt\": \"string\",\n  \"bookBackCoverPrompt\": \"string\"\n}\n\nGenerate the complete story outline now following the provided JSON schema.\n</output_format>",
  "outputFormat": "json",
  "templateVariables": {
    "novelStyle": "Story genre/style from database (e.g., 'fantasy', 'adventure')",
    "targetAudience": "Target audience from database (e.g., 'children_7-10')",
    "place": "Story setting/location from database",
    "language": "Language name derived from storyLanguage code",
    "chapterCount": "Number of chapters to generate",
    "characters": "JSON formatted character information (without IDs)",
    "bookTitle": "Story title from database",
    "storyDescription": "Brief story description",
    "description": "User's plot description from database",
    "graphicalStyle": "Visual/illustration style from database"
  }
}
